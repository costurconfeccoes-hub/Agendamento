<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Costur Confecções - Sistema de Agendamento</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <!-- Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        /* Estilos otimizados para tela de computador */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #3498db;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --text: #333;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --admin-color: #8e44ad;
            --completed-color: #27ae60;
            --in-production-color: #3498db;
        }

        body {
            background-color: #f9f9f9;
            color: var(--text);
            line-height: 1.6;
            min-width: 1200px;
            overflow-x: auto;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background-color: var(--primary);
            color: white;
            padding: 15px 0;
            box-shadow: var(--shadow);
            position: relative;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .logo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 2px solid var(--secondary);
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .logo-text h1 {
            font-size: 1.5rem;
            margin-bottom: 2px;
            color: white;
        }

        .logo-text p {
            font-style: italic;
            opacity: 0.9;
            font-size: 0.9rem;
            color: white;
        }

        .header-contact {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #FFF;
            font-size: 0.9rem;
        }

        .contact-item i {
            color: #FFF;
            font-size: 0.8rem;
        }

        .contact-item span {
            color: #FFF;
            font-weight: 500;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('https://images.unsplash.com/photo-1441986300917-64674bd600d8?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 100px 0;
            text-align: center;
        }

        .hero h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 30px;
        }

        .btn {
            display: inline-block;
            background-color: var(--secondary);
            color: white;
            padding: 12px 30px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background-color: #2980b9;
            transform: translateY(-3px);
        }

        /* Sections */
        section {
            padding: 80px 0;
        }

        .section-title {
            text-align: center;
            margin-bottom: 50px;
            position: relative;
        }

        .section-title h2 {
            font-size: 2.2rem;
            color: var(--primary);
            display: inline-block;
            padding-bottom: 10px;
        }

        .section-title h2::after {
            content: '';
            position: absolute;
            width: 80px;
            height: 3px;
            background-color: var(--secondary);
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Card Styles for Scheduling System */
        .card {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
            display: flex;
            align-items: center;
        }
        
        .card h2 i {
            margin-right: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        input, select, button {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        input:focus, select:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        
        button {
            background: var(--secondary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-cancel {
            background: var(--danger-color);
            padding: 8px 15px;
            font-size: 0.9rem;
            width: auto;
        }
        
        .btn-edit {
            background: var(--warning-color);
            padding: 8px 15px;
            font-size: 0.9rem;
            width: auto;
            margin-right: 10px;
        }
        
        .btn-delete {
            background: var(--danger-color);
            padding: 8px 15px;
            font-size: 0.9rem;
            width: auto;
        }

        .btn-correct {
            background: var(--warning-color);
            padding: 8px 15px;
            font-size: 0.9rem;
            width: auto;
            margin-right: 10px;
        }

        .btn-save {
            background: var(--success-color);
            padding: 8px 15px;
            font-size: 0.9rem;
            width: auto;
            margin-right: 10px;
        }

        .btn-download {
            background: var(--secondary);
            padding: 8px 15px;
            font-size: 0.9rem;
            width: auto;
            margin-right: 10px;
        }

        .btn-complete {
            background: var(--completed-color);
            padding: 8px 15px;
            font-size: 0.9rem;
            width: auto;
            margin-right: 10px;
        }

        .btn-update {
            background: var(--in-production-color);
            padding: 8px 15px;
            font-size: 0.9rem;
            width: auto;
            margin-right: 10px;
        }
        
        .calendar-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }
        
        .calendar {
            border: 1px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .calendar-header {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .calendar-body {
            padding: 15px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }
        
        .calendar-day {
            text-align: center;
            padding: 10px 5px;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .calendar-day.header {
            font-weight: bold;
            background-color: #f0f0f0;
            color: var(--dark);
        }
        
        .calendar-day.available {
            background-color: var(--success-color);
            color: white;
            cursor: pointer;
        }
        
        .calendar-day.available:hover {
            background-color: #27ae60;
            transform: scale(1.05);
        }
        
        .calendar-day.unavailable {
            background-color: #eee;
            color: #999;
        }
        
        .calendar-day.booked {
            background-color: var(--secondary);
            color: white;
        }
        
        .calendar-day.today {
            border: 2px solid var(--secondary);
            font-weight: bold;
            background-color: #fff9e6;
        }
        
        .appointments-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 8px;
        }
        
        .appointment-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s;
        }
        
        .appointment-item:hover {
            background-color: #f9f9f9;
        }
        
        .appointment-item:last-child {
            border-bottom: none;
        }
        
        .appointment-details {
            flex-grow: 1;
        }
        
        .appointment-dates {
            font-size: 0.9rem;
            color: #666;
        }
        
        .appointment-actions {
            display: flex;
            gap: 10px;
        }
        
        .appointment-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .status-booked {
            background-color: var(--danger-color);
            color: white;
        }
        
        .status-in-production {
            background-color: var(--in-production-color);
            color: white;
        }
        
        .status-completed {
            background-color: var(--completed-color);
            color: white;
        }
        
        .status-cancelled {
            background-color: #95a5a6;
            color: white;
        }
        
        .calculation-result {
            background: linear-gradient(135deg, #e8f4fd, #d4e9fa);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid var(--secondary);
        }
        
        .calculation-result h3 {
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .legend {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 15px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 10px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .time-slots {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .time-slot {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .time-slot.selected {
            background-color: var(--secondary);
            color: white;
        }
        
        .time-slot.disabled {
            background-color: #eee;
            color: #999;
            cursor: not-allowed;
        }
        
        .time-slot.available:hover {
            background-color: #e6f0ff;
        }
        
        .hidden {
            display: none;
        }
        
        .schedule-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid var(--warning-color);
        }
        
        .schedule-info h4 {
            color: var(--warning-color);
            margin-bottom: 8px;
        }
        
        .document-number {
            background: #e8f4fd;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-family: monospace;
            font-weight: bold;
            text-align: center;
        }
        
        .adjustment-info {
            background: #fff3cd;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            border-left: 4px solid var(--warning-color);
        }
        
        /* Footer */
        footer {
            background-color: var(--primary);
            color: white;
            padding: 40px 0 20px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }

        .footer-column h3 {
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .footer-column p, .footer-column a {
            margin-bottom: 10px;
            display: block;
            color: #ddd;
            text-decoration: none;
        }

        .footer-column a:hover {
            color: white;
        }

        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }

        .social-links a {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .social-links a:hover {
            background-color: var(--secondary);
            transform: translateY(-5px);
        }

        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            color: #aaa;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .modal-header h2 {
            color: var(--primary);
            margin: 0;
            display: flex;
            align-items: center;
            font-size: 1.3rem;
        }

        .modal-header h2 i {
            margin-right: 10px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
            width: auto;
            padding: 0;
        }

        .close-modal:hover {
            color: var(--danger-color);
        }

        .password-group {
            position: relative;
        }

        .toggle-password {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
            width: auto;
            padding: 0;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        /* Remover todas as media queries para mobile */
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo-container">
                <div class="logo">
                    <img src="https://i.pinimg.com/1200x/40/a8/e9/40a8e9533769e963fd52ccc646efc7c6.jpg" alt="Costur Confecções" id="logo-image">
                </div>
                <div class="logo-text">
                    <h1>Costur Confecções</h1>
                    <p>Sua marca, nossa costura.</p>
                </div>
            </div>
            <div class="header-contact">
                <div class="contact-item">
                    <i class="fas fa-phone"></i>
                    <span>(81) 9.2140-5569 / (81) 9.9201-4171</span>
                </div>
                <div class="contact-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Rua professor ferrucio, 436, São Francisco - Caruaru/PE</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h2>Sistema de Agendamento</h2>
            <p>Agende seus serviços de costura de forma rápida e prática.</p>
            <a href="#agendamento" class="btn">Fazer Agendamento</a>
        </div>
    </section>

    <!-- Sistema de Agendamento -->
    <section id="agendamento">
        <div class="container">
            <div class="section-title">
                <h2>Agendamento de Serviços</h2>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-calendar-plus"></i> Novo Agendamento</h2>
                <form id="appointment-form">
                    <div class="form-group">
                        <label for="client-name">Nome do Cliente</label>
                        <input type="text" id="client-name" required placeholder="Digite o nome do cliente">
                    </div>
                    
                    <div class="form-group">
                        <label for="scheduled-by">Agendado por</label>
                        <select id="scheduled-by" required>
                            <option value="">Selecione quem está agendando</option>
                            <option value="Wallison Vinicius">Wallison Vinicius</option>
                            <option value="Eduarda Emmanoelly">Eduarda Emmanoelly</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="service-date">Data de Início do Serviço</label>
                        <input type="date" id="service-date" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="quantity">Quantidade de Peças</label>
                        <input type="number" id="quantity" min="1" value="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="service-type">Tipo de Serviço</label>
                        <select id="service-type" required>
                            <option value="">Selecione o tipo de serviço</option>
                            <option value="confecção completa">Confecção completa</option>
                            <option value="Confecção parcial">Confecção parcial</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="appointment-status">Status do Agendamento</label>
                        <select id="appointment-status" required>
                            <option value="Agendado">Agendado</option>
                            <option value="Em produção">Em produção</option>
                            <option value="Realizado">Realizado</option>
                            <option value="Cancelado">Cancelado</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Horário de Início</label>
                        <div class="time-slots" id="time-slots">
                            <!-- Horários serão gerados via JavaScript -->
                        </div>
                    </div>
                    
                    <div class="schedule-info">
                        <h4><i class="fas fa-info-circle"></i> Informações do Agendamento</h4>
                        <p><strong>Data e Hora de Entrada:</strong> <span id="entry-datetime">-</span></p>
                        <p><strong>Data Estipulada para Término:</strong> <span id="completion-datetime">-</span></p>
                        <div class="document-number" id="document-number">
                            Nº do Documento: Aguardando dados...
                        </div>
                    </div>
                    
                    <div class="calculation-result" id="calculation-result">
                        <h3>Detalhes do Serviço</h3>
                        <p><strong>Dias estimados para conclusão:</strong> <span id="estimated-days">0</span> dias</p>
                    </div>
                    
                    <button type="submit" id="submit-btn">Agendar Serviço</button>
                </form>
            </div>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="total-appointments">0</div>
                    <div class="stat-label">Agendamentos Ativos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-pieces">0</div>
                    <div class="stat-label">Peças em Produção</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="occupied-days">0</div>
                    <div class="stat-label">Dias Ocupados</div>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-calendar-alt"></i> Calendário de Disponibilidade</h2>
                <div class="calendar-container">
                    <div class="calendar">
                        <div class="calendar-header" id="current-month">Carregando...</div>
                        <div class="calendar-body">
                            <div class="calendar-grid" id="calendar-days">
                                <!-- Dias serão gerados via JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3>Legenda</h3>
                        <div class="legend">
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: var(--success-color);"></div>
                                <span>Disponível para agendamento</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: var(--secondary);"></div>
                                <span>Período ocupado</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="border: 2px solid var(--secondary); background-color: #fff9e6;"></div>
                                <span>Dia atual</span>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <button id="prev-month">Mês Anterior</button>
                            <button id="next-month" style="margin-top: 10px;">Próximo Mês</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-list"></i> Histórico de Agendamentos</h2>
                
                <div class="appointments-list" id="appointments-list">
                    <!-- Todos os agendamentos serão listados aqui -->
                </div>
            </div>
        </div>
    </section>

    <!-- Modal para Edição -->
    <div class="modal" id="edit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> Editar Agendamento</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="edit-form">
                <div class="form-group">
                    <label for="edit-client-name">Nome do Cliente</label>
                    <input type="text" id="edit-client-name" required>
                </div>
                
                <div class="form-group">
                    <label for="edit-scheduled-by">Agendado por</label>
                    <select id="edit-scheduled-by" required>
                        <option value="Wallison Vinicius">Wallison Vinicius</option>
                        <option value="Eduarda Emmanoelly">Eduarda Emmanoelly</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="edit-service-date">Data de Início</label>
                    <input type="date" id="edit-service-date" required>
                </div>
                
                <div class="form-group">
                    <label for="edit-quantity">Quantidade de Peças</label>
                    <input type="number" id="edit-quantity" min="1" required>
                </div>
                
                <div class="form-group">
                    <label for="edit-service-type">Tipo de Serviço</label>
                    <select id="edit-service-type" required>
                        <option value="confecção completa">Confecção completa</option>
                        <option value="Confecção parcial">Confecção parcial</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="edit-status">Status do Agendamento</label>
                    <select id="edit-status" required>
                        <option value="active">Agendado</option>
                        <option value="in-production">Em produção</option>
                        <option value="completed">Realizado</option>
                        <option value="cancelled">Cancelado</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Horário de Início</label>
                    <div class="time-slots" id="edit-time-slots">
                        <!-- Horários serão gerados via JavaScript -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="edit-password">Senha de Acesso</label>
                    <div class="password-group">
                        <input type="password" id="edit-password" required placeholder="Digite a senha para editar">
                        <button type="button" class="toggle-password" id="toggle-password">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn-cancel" id="cancel-edit">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="submit" class="btn-save">
                        <i class="fas fa-save"></i> Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Costur Confecções</h3>
                    <p>Sua marca, nossa costura. Oferecemos serviços de confecção com qualidade e agilidade.</p>
                    <div class="social-links">
                        <a href="https://www.instagram.com/costurconfeccoes"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
                <div class="footer-column">
                    <h3>Contato</h3>
                    <p><i class="fas fa-phone"></i> (81) 9.2140-5569</p>
                    <p><i class="fas fa-phone"></i> (81) 9.9201-4171</p>
                    <p><i class="fas fa-map-marker-alt"></i> Rua professor ferrucio, 436, São Francisco - Caruaru/PE</p>
                </div>
                <div class="footer-column">
                    <h3>Horário de Funcionamento</h3>
                    <p>Segunda a Sexta: 08:00 às 12:00 - 14:00 às 18:00</p>
                    <p>Sábado: 08:00 às 14:00</p>
                    <p>Domingo: Fechado</p>
                </div>
            </div>
            
            <div class="copyright">
                &copy; 2023 Costur Confecções. Todos os direitos reservados.
            </div>
        </div>
    </footer>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAc1iUDZEjyDOtrY9UT_idP5_TGODIsc9E",
            authDomain: "costur-agendamentos.firebaseapp.com",
            projectId: "costur-agendamentos",
            storageBucket: "costur-agendamentos.firebasestorage.app",
            messagingSenderId: "948222283708",
            appId: "1:948222283708:web:a82876883f247e51ede5b9"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Armazenamento de agendamentos
        let appointments = [];
        let bookedDates = {};
        let currentEditingIndex = null;

        // Variáveis globais para o calendário
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();

        // Senha para edição
        const EDIT_PASSWORD = "CosturADM2023";

        // Função para carregar agendamentos do Firestore
        async function loadAppointmentsFromFirestore() {
            try {
                const snapshot = await db.collection('appointments').orderBy('createdAt', 'desc').get();
                appointments = [];
                snapshot.forEach(doc => {
                    appointments.push({ id: doc.id, ...doc.data() });
                });
                
                // Atualizar a interface
                loadAppointmentsList();
                updateStats();
                updateBookedDates(); // Atualizar bookedDates primeiro
                generateCalendar(currentMonth, currentYear); // Depois gerar calendário
                
                console.log("Agendamentos carregados:", appointments.length);
            } catch (error) {
                console.error("Erro ao carregar agendamentos:", error);
            }
        }

        // Função para salvar agendamento no Firestore
        async function saveAppointmentToFirestore(appointment) {
            try {
                const docRef = await db.collection('appointments').add(appointment);
                return docRef.id;
            } catch (error) {
                console.error("Erro ao salvar agendamento:", error);
                throw error;
            }
        }

        // Função para atualizar agendamento no Firestore
        async function updateAppointmentInFirestore(id, updates) {
            try {
                await db.collection('appointments').doc(id).update(updates);
            } catch (error) {
                console.error("Erro ao atualizar agendamento:", error);
                throw error;
            }
        }

        // Função para atualizar bookedDates
        function updateBookedDates() {
            bookedDates = {};
            appointments.forEach(appointment => {
                if (appointment.status === 'active' || appointment.status === 'in-production') {
                    const start = new Date(appointment.serviceDate);
                    const estimatedDays = appointment.estimatedDays || calculateEstimatedDays(appointment.serviceDate, appointment.quantity);
                    
                    for (let i = 0; i < estimatedDays; i++) {
                        const currentDate = new Date(start);
                        currentDate.setDate(start.getDate() + i);
                        
                        const dateKey = currentDate.toISOString().split('T')[0];
                        bookedDates[dateKey] = true;
                    }
                }
            });
            console.log("Datas ocupadas atualizadas:", Object.keys(bookedDates).length);
        }

        // Função para calcular dias estimados considerando finais de semana
        function calculateEstimatedDays(startDate, quantity) {
            let baseDays = (quantity / 45) + 1;
            let totalDays = Math.ceil(baseDays);
            
            let currentDate = new Date(startDate);
            let weekendDays = 0;
            
            for (let i = 0; i < totalDays; i++) {
                let checkDate = new Date(currentDate);
                checkDate.setDate(currentDate.getDate() + i);
                let dayOfWeek = checkDate.getDay();
                
                if (dayOfWeek === 6) {
                    weekendDays += 0.25;
                }
                else if (dayOfWeek === 0) {
                    weekendDays += 1;
                }
            }
            
            totalDays += weekendDays;
            return Math.ceil(totalDays);
        }

        // Função para calcular a data de término
        function calculateCompletionDate(startDate, estimatedDays) {
            let completionDate = new Date(startDate);
            completionDate.setDate(completionDate.getDate() + estimatedDays);
            return completionDate;
        }

        // Função para marcar dias como ocupados no calendário
        function markDaysAsBooked(startDate, estimatedDays) {
            const start = new Date(startDate);
            
            for (let i = 0; i < estimatedDays; i++) {
                const currentDate = new Date(start);
                currentDate.setDate(start.getDate() + i);
                
                const dateKey = currentDate.toISOString().split('T')[0];
                bookedDates[dateKey] = true;
            }
            
            updateBookedDates();
            generateCalendar(currentMonth, currentYear); // Atualizar calendário imediatamente
        }

        // Função para gerar comprovante do agendamento em PNG
        function generateAppointmentPNG(appointment) {
            // Criar um canvas para gerar a imagem
            const canvas = document.createElement('canvas');
            canvas.width = 800;
            canvas.height = 600;
            const ctx = canvas.getContext('2d');
            
            // Fundo branco
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Cabeçalho
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(0, 0, canvas.width, 80);
            
            ctx.fillStyle = 'white';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Costur Confecções', canvas.width / 2, 35);
            
            ctx.font = '16px Arial';
            ctx.fillText('Comprovante de Agendamento', canvas.width / 2, 60);
            
            // Informações do agendamento
            ctx.fillStyle = '#333';
            ctx.textAlign = 'left';
            ctx.font = 'bold 18px Arial';
            ctx.fillText('Informações do Agendamento', 50, 120);
            
            ctx.font = '14px Arial';
            let yPosition = 160;
            
            ctx.fillText(`Cliente: ${appointment.clientName}`, 50, yPosition);
            yPosition += 30;
            
            ctx.fillText(`Agendado por: ${appointment.scheduledBy}`, 50, yPosition);
            yPosition += 30;
            
            ctx.fillText(`Data de Início: ${appointment.serviceDate}`, 50, yPosition);
            yPosition += 30;
            
            ctx.fillText(`Horário: ${appointment.serviceTime}`, 50, yPosition);
            yPosition += 30;
            
            ctx.fillText(`Quantidade de Peças: ${appointment.quantity}`, 50, yPosition);
            yPosition += 30;
            
            ctx.fillText(`Tipo de Serviço: ${appointment.serviceType}`, 50, yPosition);
            yPosition += 30;
            
            ctx.fillText(`Status: ${appointment.status}`, 50, yPosition);
            yPosition += 30;
            
            ctx.fillText(`Dias Estimados: ${appointment.estimatedDays} dias`, 50, yPosition);
            yPosition += 30;
            
            const completionDate = calculateCompletionDate(appointment.serviceDate, appointment.estimatedDays);
            ctx.fillText(`Data de Término: ${completionDate.toLocaleDateString('pt-BR')}`, 50, yPosition);
            yPosition += 40;
            
            ctx.font = 'bold 16px Arial';
            ctx.fillText(`Nº do Documento: ${appointment.documentNumber || 'DOC-' + appointment.id.toString().slice(-6)}`, 50, yPosition);
            
            // Rodapé
            ctx.fillStyle = '#2c3e50';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Costur Confecções - Sua marca, nossa costura', canvas.width / 2, 550);
            ctx.fillText('Rua professor ferrucio, 436, São Francisco - Caruaru/PE', canvas.width / 2, 570);
            
            // Converter para PNG e fazer download
            const dataURL = canvas.toDataURL('image/png');
            const link = document.createElement('a');
            link.download = `${appointment.clientName} - ${appointment.serviceDate.split('-').reverse().join('-')}.png`;
            link.href = dataURL;
            link.click();
        }

        // Função para mostrar modal de edição
        function showEditModal(index) {
            currentEditingIndex = index;
            const appointment = appointments[index];
            
            // Preenche o formulário com os dados atuais
            document.getElementById('edit-client-name').value = appointment.clientName;
            document.getElementById('edit-scheduled-by').value = appointment.scheduledBy;
            document.getElementById('edit-service-date').value = appointment.serviceDate;
            document.getElementById('edit-quantity').value = appointment.quantity;
            document.getElementById('edit-service-type').value = appointment.serviceType;
            document.getElementById('edit-status').value = appointment.status;
            
            // Gera os time slots
            generateTimeSlotsForEdit(appointment.serviceTime);
            
            // Limpa o campo de senha
            document.getElementById('edit-password').value = '';
            
            // Mostra o modal
            document.getElementById('edit-modal').style.display = 'flex';
        }

        // Função para gerar time slots para edição
        function generateTimeSlotsForEdit(selectedTime) {
            const timeSlotsContainer = document.getElementById('edit-time-slots');
            const timeSlots = ['08:00', '09:00', '10:00', '11:00', '14:00', '15:00', '16:00', '17:00'];
            
            let timeSlotsHTML = '';
            
            timeSlots.forEach(time => {
                const isSelected = time === selectedTime ? 'selected' : '';
                timeSlotsHTML += `<div class="time-slot available ${isSelected}" data-time="${time}">${time}</div>`;
            });
            
            timeSlotsContainer.innerHTML = timeSlotsHTML;
            
            // Adiciona eventos aos time slots
            document.querySelectorAll('#edit-time-slots .time-slot').forEach(slot => {
                slot.addEventListener('click', function() {
                    document.querySelectorAll('#edit-time-slots .time-slot.selected').forEach(s => {
                        s.classList.remove('selected');
                    });
                    this.classList.add('selected');
                });
            });
        }

        // Função para salvar edição
        async function saveEdit() {
            const appointment = appointments[currentEditingIndex];
            
            // Verifica a senha
            const password = document.getElementById('edit-password').value;
            if (password !== EDIT_PASSWORD) {
                alert('Senha incorreta. A edição não foi autorizada.');
                return;
            }
            
            // Coleta os novos valores
            const clientName = document.getElementById('edit-client-name').value;
            const scheduledBy = document.getElementById('edit-scheduled-by').value;
            const serviceDate = document.getElementById('edit-service-date').value;
            const quantity = document.getElementById('edit-quantity').value;
            const serviceType = document.getElementById('edit-service-type').value;
            const status = document.getElementById('edit-status').value;
            const selectedTimeElement = document.querySelector('#edit-time-slots .time-slot.selected');
            
            if (!selectedTimeElement) {
                alert('Por favor, selecione um horário.');
                return;
            }
            
            const serviceTime = selectedTimeElement.getAttribute('data-time');
            
            // Calcula os novos dias estimados
            const estimatedDays = calculateEstimatedDays(serviceDate, parseInt(quantity));
            
            // Atualiza o agendamento
            const updates = {
                clientName: clientName,
                scheduledBy: scheduledBy,
                serviceDate: serviceDate,
                quantity: parseInt(quantity),
                serviceType: serviceType,
                serviceTime: serviceTime,
                status: status,
                estimatedDays: estimatedDays,
                updatedAt: new Date().toISOString()
            };
            
            try {
                await updateAppointmentInFirestore(appointment.id, updates);
                
                // Atualiza o agendamento local
                Object.assign(appointment, updates);
                
                // Atualiza as datas ocupadas
                updateBookedDates();
                
                // Atualiza a interface
                loadAppointmentsList();
                updateStats();
                generateCalendar(currentMonth, currentYear);
                
                // Fecha o modal
                closeEditModal();
                
                alert('Agendamento atualizado com sucesso!');
            } catch (error) {
                console.error('Erro ao salvar edição:', error);
                alert('Erro ao salvar edição. Tente novamente.');
            }
        }

        // Função para fechar o modal de edição
        function closeEditModal() {
            document.getElementById('edit-modal').style.display = 'none';
            currentEditingIndex = null;
        }

        // Função para carregar agendamentos na lista principal
        function loadAppointmentsList() {
            const appointmentsContainer = document.getElementById('appointments-list');
            
            if (appointments.length === 0) {
                appointmentsContainer.innerHTML = '<p style="padding: 20px; text-align: center;">Nenhum agendamento encontrado.</p>';
                return;
            }
            
            let appointmentsHTML = '';
            
            appointments.forEach((appointment, index) => {
                let statusClass = 'status-booked';
                let statusText = 'Agendado';
                
                if (appointment.status === 'cancelled') {
                    statusClass = 'status-cancelled';
                    statusText = 'Cancelado';
                } else if (appointment.status === 'completed') {
                    statusClass = 'status-completed';
                    statusText = 'Realizado';
                } else if (appointment.status === 'in-production') {
                    statusClass = 'status-in-production';
                    statusText = 'Em produção';
                }
                
                appointmentsHTML += `
                    <div class="appointment-item" data-appointment-id="${appointment.id}">
                        <div class="appointment-details">
                            <h4>${appointment.clientName}</h4>
                            <p><strong>Agendado por:</strong> ${appointment.scheduledBy}</p>
                            <p><strong>Data:</strong> ${appointment.serviceDate} às ${appointment.serviceTime}</p>
                            <p><strong>Peças:</strong> ${appointment.quantity} | <strong>Tipo:</strong> ${appointment.serviceType}</p>
                            <p><strong>Previsão de Término:</strong> ${calculateCompletionDate(appointment.serviceDate, appointment.estimatedDays).toLocaleDateString('pt-BR')}</p>
                            <div class="appointment-status ${statusClass}">${statusText}</div>
                        </div>
                        <div class="appointment-actions">
                            <button class="btn-update" onclick="showEditModal(${index})">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                        </div>
                    </div>
                `;
            });
            
            appointmentsContainer.innerHTML = appointmentsHTML;
        }
        
        // Função para gerar o calendário
        function generateCalendar(month, year) {
            try {
                const monthNames = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
                                   "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
                
                document.getElementById('current-month').textContent = `${monthNames[month]} ${year}`;
                
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                
                const today = new Date();
                const currentDay = today.getDate();
                const currentMonthToday = today.getMonth();
                const currentYearToday = today.getFullYear();
                
                const dayNames = ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "Sáb"];
                let calendarHTML = '';
                
                // Cabeçalho com dias da semana
                dayNames.forEach(day => {
                    calendarHTML += `<div class="calendar-day header">${day}</div>`;
                });
                
                // Dias vazios no início
                for (let i = 0; i < firstDay; i++) {
                    calendarHTML += `<div class="calendar-day unavailable"></div>`;
                }
                
                // Dias do mês
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateKey = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                    let dayClass = "calendar-day available";
                    
                    // Verifica se está ocupado
                    if (bookedDates[dateKey]) {
                        dayClass = "calendar-day booked";
                    }
                    
                    // Verifica se é hoje
                    if (day === currentDay && month === currentMonthToday && year === currentYearToday) {
                        dayClass += " today";
                    }
                    
                    calendarHTML += `<div class="${dayClass}" data-day="${day}" data-month="${month}" data-year="${year}">${day}</div>`;
                }
                
                document.getElementById('calendar-days').innerHTML = calendarHTML;
                
                // Adiciona eventos de clique aos dias disponíveis
                document.querySelectorAll('.calendar-day.available').forEach(day => {
                    day.addEventListener('click', function() {
                        const selectedDay = this.getAttribute('data-day');
                        const selectedMonth = parseInt(this.getAttribute('data-month')) + 1;
                        const selectedYear = this.getAttribute('data-year');
                        
                        const formattedDate = `${selectedYear}-${selectedMonth.toString().padStart(2, '0')}-${selectedDay.padStart(2, '0')}`;
                        document.getElementById('service-date').value = formattedDate;
                        updateTimeSlots();
                    });
                });
                
            } catch (error) {
                console.error("Erro ao gerar calendário:", error);
                document.getElementById('current-month').textContent = "Erro ao carregar";
                document.getElementById('calendar-days').innerHTML = '<div class="calendar-day">Erro</div>';
            }
        }
        
        // Função para atualizar os horários disponíveis
        function updateTimeSlots() {
            const timeSlotsContainer = document.getElementById('time-slots');
            const timeSlots = [
                '08:00', '09:00', '10:00', '11:00', 
                '14:00', '15:00', '16:00', '17:00'
            ];
            
            let timeSlotsHTML = '';
            
            timeSlots.forEach(time => {
                timeSlotsHTML += `<div class="time-slot available" data-time="${time}">${time}</div>`;
            });
            
            timeSlotsContainer.innerHTML = timeSlotsHTML;
            
            document.querySelectorAll('.time-slot.available').forEach(slot => {
                slot.addEventListener('click', function() {
                    document.querySelectorAll('.time-slot.selected').forEach(s => {
                        s.classList.remove('selected');
                    });
                    
                    this.classList.add('selected');
                    updateScheduleInfo();
                });
            });
        }
        
        // Função para atualizar as informações do agendamento
        function updateScheduleInfo() {
            const serviceDate = document.getElementById('service-date').value;
            const selectedTime = document.querySelector('.time-slot.selected')?.getAttribute('data-time');
            const quantity = document.getElementById('quantity').value;
            
            if (serviceDate && selectedTime && quantity) {
                const entryDateTime = `${serviceDate.split('-').reverse().join('/')} às ${selectedTime}`;
                document.getElementById('entry-datetime').textContent = entryDateTime;
                
                const estimatedDays = calculateEstimatedDays(serviceDate, parseInt(quantity));
                document.getElementById('estimated-days').textContent = estimatedDays;
                
                const completionDate = calculateCompletionDate(serviceDate, estimatedDays);
                const formattedCompletionDate = completionDate.toLocaleDateString('pt-BR');
                document.getElementById('completion-datetime').textContent = formattedCompletionDate;
                
                const docNumber = `DOC-${Date.now().toString().slice(-6)}`;
                document.getElementById('document-number').textContent = `Nº do Documento: ${docNumber}`;
            }
        }
        
        // Função para atualizar estatísticas
        function updateStats() {
            const activeAppointments = appointments.filter(a => a.status === 'active' || a.status === 'in-production').length;
            const totalPieces = appointments.reduce((sum, appointment) => {
                if (appointment.status === 'active' || appointment.status === 'in-production') {
                    return sum + parseInt(appointment.quantity);
                }
                return sum;
            }, 0);
            
            const uniqueDates = new Set();
            appointments.forEach(appointment => {
                if (appointment.status === 'active' || appointment.status === 'in-production') {
                    uniqueDates.add(appointment.serviceDate);
                }
            });
            
            document.getElementById('total-appointments').textContent = activeAppointments;
            document.getElementById('total-pieces').textContent = totalPieces;
            document.getElementById('occupied-days').textContent = uniqueDates.size;
        }
        
        // Inicialização do sistema
        document.addEventListener('DOMContentLoaded', function() {
            // Carrega agendamentos do Firestore
            loadAppointmentsFromFirestore();
            
            // Gera o calendário inicial
            generateCalendar(currentMonth, currentYear);
            
            // Define a data mínima para o campo de data como hoje
            const today = new Date();
            const minDate = today.toISOString().split('T')[0];
            document.getElementById('service-date').min = minDate;
            
            // Adiciona eventos aos botões de navegação do calendário
            document.getElementById('prev-month').addEventListener('click', function() {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                generateCalendar(currentMonth, currentYear);
            });
            
            document.getElementById('next-month').addEventListener('click', function() {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                generateCalendar(currentMonth, currentYear);
            });
            
            // Atualiza os horários quando a data é alterada
            document.getElementById('service-date').addEventListener('change', updateTimeSlots);
            
            // Atualiza as informações quando a quantidade é alterada
            document.getElementById('quantity').addEventListener('change', updateScheduleInfo);
            
            // Adiciona evento de envio do formulário
            document.getElementById('appointment-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const clientName = document.getElementById('client-name').value;
                const scheduledBy = document.getElementById('scheduled-by').value;
                const serviceDate = document.getElementById('service-date').value;
                const quantity = document.getElementById('quantity').value;
                const serviceType = document.getElementById('service-type').value;
                const status = document.getElementById('appointment-status').value;
                const selectedTime = document.querySelector('.time-slot.selected')?.getAttribute('data-time');
                
                if (!selectedTime) {
                    alert('Por favor, selecione um horário.');
                    return;
                }
                
                // Calcula os dias estimados
                const estimatedDays = calculateEstimatedDays(serviceDate, parseInt(quantity));
                const documentNumber = `DOC-${Date.now().toString().slice(-6)}`;
                
                // Cria o agendamento
                const newAppointment = {
                    clientName,
                    scheduledBy,
                    serviceDate,
                    serviceTime: selectedTime,
                    quantity: parseInt(quantity),
                    serviceType,
                    status: status === 'Agendado' ? 'active' : 
                           status === 'Em produção' ? 'in-production' :
                           status === 'Realizado' ? 'completed' : 'cancelled',
                    estimatedDays,
                    documentNumber,
                    createdAt: new Date().toISOString()
                };
                
                try {
                    // Salva no Firestore
                    const id = await saveAppointmentToFirestore(newAppointment);
                    newAppointment.id = id;
                    
                    // Adiciona ao array de agendamentos
                    appointments.push(newAppointment);
                    
                    // Marca os dias como ocupados no calendário
                    markDaysAsBooked(serviceDate, estimatedDays);
                    
                    // Gera o PNG automaticamente
                    generateAppointmentPNG(newAppointment);
                    
                    // Atualiza a interface
                    loadAppointmentsList();
                    updateStats();
                    
                    alert('Agendamento realizado com sucesso! O comprovante foi baixado automaticamente.');
                    
                    // Limpa o formulário
                    document.getElementById('appointment-form').reset();
                    document.getElementById('time-slots').innerHTML = '';
                    document.getElementById('entry-datetime').textContent = '-';
                    document.getElementById('completion-datetime').textContent = '-';
                    document.getElementById('document-number').textContent = 'Nº do Documento: Aguardando dados...';
                    document.getElementById('estimated-days').textContent = '0';
                } catch (error) {
                    alert('Erro ao realizar agendamento. Tente novamente.');
                }
            });
            
            // Configura o modal de edição
            const editModal = document.getElementById('edit-modal');
            const closeModalBtn = document.querySelector('.close-modal');
            const cancelEditBtn = document.getElementById('cancel-edit');
            const editForm = document.getElementById('edit-form');
            const togglePasswordBtn = document.getElementById('toggle-password');
            const editPasswordField = document.getElementById('edit-password');
            
            // Fechar modal ao clicar no X
            closeModalBtn.addEventListener('click', closeEditModal);
            
            // Fechar modal ao clicar no botão Cancelar
            cancelEditBtn.addEventListener('click', closeEditModal);
            
            // Fechar modal ao clicar fora do conteúdo
            editModal.addEventListener('click', function(e) {
                if (e.target === editModal) {
                    closeEditModal();
                }
            });
            
            // Submeter formulário de edição
            editForm.addEventListener('submit', function(e) {
                e.preventDefault();
                saveEdit();
            });
            
            // Alternar visibilidade da senha
            togglePasswordBtn.addEventListener('click', function() {
                const type = editPasswordField.getAttribute('type') === 'password' ? 'text' : 'password';
                editPasswordField.setAttribute('type', type);
                
                // Alternar ícone
                const icon = this.querySelector('i');
                icon.classList.toggle('fa-eye');
                icon.classList.toggle('fa-eye-slash');
            });
            
            // Atualiza estatísticas iniciais e lista de agendamentos
            updateStats();
            loadAppointmentsList();
        });
    </script>
</body>
</html>
